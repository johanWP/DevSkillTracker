
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if a user is an admin.
    // NOTE: This list should be kept in sync with the frontend ADMIN_EMAILS constant.
    // For a more robust solution, consider using Firebase Custom Claims to set an 'admin' role.
    function isAdmin() {
      return request.auth.token.email in [
        "admin1@company.com",
        "admin2@company.com",
        "testadmin@example.com"
        // ...add other admin emails here
      ];
    }

    // Protect the 'devs' collection
    match /devs/{devId} {
      // Only authenticated admins can read, create, update, or delete developer documents.
      allow read, write: if request.auth != null && isAdmin();
    }
    
    // Protect the 'config' collection
    match /config/{configId} {
      // Only authenticated admins can read the configuration (e.g., skills catalog).
      // Writing to config is disabled from the client for safety. It should be done
      // via the Firebase Console or an admin SDK.
      allow read: if request.auth != null && isAdmin();
      allow write: if false;
    }
    
    // Deny all other access by default.
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
